<!DOCTYPE html>
<html lang="en">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="">
  <title>egg | 琼喵酱·部落</title>
  <meta name="author" content="zengqm" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="egg" />
  
  <meta name="description" content="egg.js参考教程视频 https:&#x2F;&#x2F;b23.tv&#x2F;wu9Dc9 egg.js 的特性:1、提供基于 Egg 定制上层框架的能力2、高度可扩展的插件机制3、内置多进程管理 4、基于 Koa 开发，性能优异5、框架稳定，测试覆盖率高6、渐进式开发 创建egg的环境npm i egg-init -g(只需要安装一次) 创建项目终端cd 到项目要放置的路径中（注意目录最好是不要用中文  不要有空格）">
<meta property="og:type" content="article">
<meta property="og:title" content="egg">
<meta property="og:url" content="http://example.com/2021/09/20/egg.js/index.html">
<meta property="og:site_name" content="琼喵酱·部落">
<meta property="og:description" content="egg.js参考教程视频 https:&#x2F;&#x2F;b23.tv&#x2F;wu9Dc9 egg.js 的特性:1、提供基于 Egg 定制上层框架的能力2、高度可扩展的插件机制3、内置多进程管理 4、基于 Koa 开发，性能优异5、框架稳定，测试覆盖率高6、渐进式开发 创建egg的环境npm i egg-init -g(只需要安装一次) 创建项目终端cd 到项目要放置的路径中（注意目录最好是不要用中文  不要有空格）">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/null">
<meta property="article:published_time" content="2021-09-20T14:35:44.871Z">
<meta property="article:modified_time" content="2021-09-21T13:52:10.106Z">
<meta property="article:author" content="zengqm">
<meta property="article:tag" content="egg">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/null">
<meta name="twitter:site" content="@null">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" type="text/css" media="all">
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" type="text/css" media="all">
  
  
  <link rel="stylesheet" id="fontawe-css" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" type="text/css" media="all">
  <link rel="stylesheet" id="nprogress-css" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" type="text/css" media="all">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-dark.min.css" type="text/css" media="all">
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/qrcode_js@1.0.0/qrcode.min.js"></script>
  
  
  <style>
    
      .kratos-cover.kratos-cover-2 {
        background-image: url('/images/banner.webp');
      }
    
    
      @media(min-width:768px) {
        body.custom-background {
          background-image: url('/images/bg.webp');
        }
      }
    
  </style>
  
<meta name="generator" content="Hexo 5.4.0"></head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                        <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                    
                                
                                    
                                        <li><a href="/archives/"><i class="fa fa-file"></i>档案馆</a></li>
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">琼喵酱·部落</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>琼喵酱·部落</h2> <br />
                        <span></span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        

            <section class="col-md-8">

        

            <article>
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center">egg</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><i class="fa fa-calendar"></i> 2021-09-20</li>
                <li><i class="fa fa-user"></i> 作者 zengqm</li>
                <li>
                    <i class="fa fa-edit"></i> 
                    
                    
                        ~17.82K
                    
                    字
                </li>
                
            </ul>
        </header>
        <div class="kratos-post-content">
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                本文最后编辑于 <time datetime="1632232330106"></time> 前，其中的内容可能需要更新。
            </div>
            
                <div class="kratos-post-inner-toc">
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#egg-js"><span class="toc-number">1.</span> <span class="toc-text">egg.js</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#egg-js-%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.</span> <span class="toc-text">egg.js 的特性:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAegg%E7%9A%84%E7%8E%AF%E5%A2%83"><span class="toc-number">1.2.</span> <span class="toc-text">创建egg的环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.3.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">1.4.</span> <span class="toc-text">路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96get%E4%BC%A0%E5%80%BC"><span class="toc-number">1.5.</span> <span class="toc-text">获取get传值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">1.6.</span> <span class="toc-text">动态路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-%E8%A7%86%E5%9B%BE%EF%BC%88view%EF%BC%89egg-view-ejs"><span class="toc-number">1.7.</span> <span class="toc-text">加载模板引擎  视图（view）egg-view-ejs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%95%B0%E6%8D%AE%E5%86%97%E4%BD%99"><span class="toc-number">1.8.</span> <span class="toc-text">解决数据冗余</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.9.</span> <span class="toc-text">服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%AC%E5%8F%96api%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE"><span class="toc-number">1.10.</span> <span class="toc-text">爬取api接口数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extend"><span class="toc-number">1.11.</span> <span class="toc-text">extend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.12.</span> <span class="toc-text">中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#post%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.13.</span> <span class="toc-text">post提交数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie"><span class="toc-number">1.14.</span> <span class="toc-text">Cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E5%90%8C%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E5%90%8C%E4%B8%80%E4%B8%AA%E5%9F%9F%EF%BC%8Cnews%E9%A1%B5%E9%9D%A2%E8%83%BD%E8%AE%BF%E9%97%AE%E5%88%B0%E4%B8%BB%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%80%BC"><span class="toc-number">1.14.1.</span> <span class="toc-text">需求：同一个浏览器访问同一个域，news页面能访问到主页面的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82-%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.14.2.</span> <span class="toc-text">需求:实现数据的持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">1.14.3.</span> <span class="toc-text">其他参数：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%96%87cookie-encrypt-true"><span class="toc-number">1.14.4.</span> <span class="toc-text">设置中文cookie (encrypt :true)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4cookie"><span class="toc-number">1.14.5.</span> <span class="toc-text">清除cookie</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session%E5%9F%BA%E4%BA%8ECookie"><span class="toc-number">1.15.</span> <span class="toc-text">session基于Cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82"><span class="toc-number">1.16.</span> <span class="toc-text">请求</span></a></li></ol></li></ol>
                </div>
            
            <hr />
            <h1 id="egg-js"><a href="#egg-js" class="headerlink" title="egg.js"></a>egg.js</h1><p>参考教程视频 <a target="_blank" rel="noopener" href="https://b23.tv/wu9Dc9">https://b23.tv/wu9Dc9</a></p>
<h2 id="egg-js-的特性"><a href="#egg-js-的特性" class="headerlink" title="egg.js 的特性:"></a>egg.js 的特性:</h2><p>1、提供基于 Egg 定制上层框架的能力2、高度可扩展的插件机制3、内置多进程管理</p>
<p>4、基于 Koa 开发，性能优异5、框架稳定，测试覆盖率高6、渐进式开发</p>
<h2 id="创建egg的环境"><a href="#创建egg的环境" class="headerlink" title="创建egg的环境"></a>创建egg的环境</h2><p><code>npm i egg-init -g(只需要安装一次)</code></p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>终端cd 到项目要放置的路径中（注意目录最好是不要用中文  不要有空格）</p>
<p>​    egg-init 项目名称 –type=simple  </p>
<p>创建项目 如：</p>
<p><code>egg-init eggdemo01 --type=simple</code></p>
<p>cd到项目目录下，cd eggdemo01 </p>
<p>安装依赖  <code>npm install</code>，</p>
<p>安装成功后直接执行<code>npm run dev</code>，</p>
<p>默认端口是7001，然后在浏览器中打开localhost:7001</p>
<p>如果出现如下图所示就说明初始化项目成功了，如果安装依赖失败那么可以强制npm清理一下缓存npm cache clean –force然后再安装，如果还是报错可以翻墙到外面再试下。</p>
<p>vs插件市场eggjs</p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>路由不需要引入，可直接使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Egg.Application&#125;</span> <span class="variable">app</span></span> - egg application</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; router, controller &#125; = app;</span><br><span class="line">  router.get(<span class="string">&#x27;/&#x27;</span>, controller.home.index);</span><br><span class="line">  router.get(<span class="string">&#x27;/news&#x27;</span>,controller.home.news);</span><br><span class="line">  router.get(<span class="string">&#x27;/admin&#x27;</span>,controller.admin.index);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>egg是一个MVC的框架：</p>
<p>view            视图 模板 页面的展示</p>
<p>Controller 控制器 负责处理一些业务逻辑</p>
<p>model         模型（service）  和数据库打交道（查询数据库、操作数据库数据 请求数据）(复杂的业务逻辑 以及数据操作)</p>
<p>结构：</p>
<p>Controller 控制器</p>
<p>service 服务</p>
<p>extend 扩展</p>
<p>middleware 中间件</p>
<h2 id="获取get传值"><a href="#获取get传值" class="headerlink" title="获取get传值"></a>获取get传值</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">content</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 获取get传值</span></span><br><span class="line">  <span class="comment">// koa中如何获取get传值ctx.query</span></span><br><span class="line">  <span class="comment">// egg.js里面获取get传值</span></span><br><span class="line">  <span class="keyword">const</span> query = <span class="built_in">this</span>.ctx.query;</span><br><span class="line">  <span class="built_in">console</span>.log(query);</span><br><span class="line">  <span class="built_in">this</span>.ctx.body = <span class="string">&#x27;新闻详情&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h2><p>1、在controller的news.js中添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">async</span> <span class="function"><span class="title">newslist</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">//  koa获取动态路由传值   ctx.params</span></span><br><span class="line">  <span class="keyword">const</span> params = <span class="built_in">this</span>.ctx.params;</span><br><span class="line">  <span class="built_in">console</span>.log(params);</span><br><span class="line">  <span class="built_in">this</span>.ctx.body = <span class="string">&#x27;新闻列表&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在view的router.js添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/newslist/:id&#x27;</span>, controller.news.newslist);</span><br></pre></td></tr></table></figure>



<h2 id="加载模板引擎-视图（view）egg-view-ejs"><a href="#加载模板引擎-视图（view）egg-view-ejs" class="headerlink" title="加载模板引擎  视图（view）egg-view-ejs"></a>加载模板引擎  视图（view）egg-view-ejs</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i egg-view-ejs --save</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#123;app_root&#125;/config/plugin.js</span></span><br><span class="line"><span class="built_in">exports</span>.ejs = &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&#x27;egg-view-ejs&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;app_root&#125;/config/config.default.js</span></span><br><span class="line">  <span class="comment">// 配置模板引擎 ejs解析.html</span></span><br><span class="line">  config.view = &#123;</span><br><span class="line">    <span class="attr">mapping</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;.html&#x27;</span>: <span class="string">&#x27;ejs&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>在view中新建news.html</p>
<p>在controller的news.js中添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// this.ctx.body = &#x27;新闻页面&#x27;;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注意 await</span></span><br><span class="line">  <span class="comment">//渲染模板引擎 render(名称,数据)</span></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;news&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行<a target="_blank" rel="noopener" href="http://127.0.0.1:7001/news%E5%8D%B3%E5%8F%AF">http://127.0.0.1:7001/news即可</a></p>
<p>在页面添加数据</p>
<p>1、在controller的news.js中添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// this.ctx.body = &#x27;新闻页面&#x27;;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注意 await</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> msg = <span class="string">&#x27;ejs&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> list = [ <span class="string">&#x27;1111&#x27;</span>, <span class="string">&#x27;2222&#x27;</span>, <span class="string">&#x27;3333&#x27;</span> ];</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;news&#x27;</span>, &#123;</span><br><span class="line">    msg,</span><br><span class="line">    list,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、news.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>这是一个新闻--&lt;%=msg%&gt;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &lt;%for(var i=0;i&lt;list.length;i++)&#123;%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&lt;%=list[i]%&gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &lt;%&#125;%&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="解决数据冗余"><a href="#解决数据冗余" class="headerlink" title="解决数据冗余"></a>解决数据冗余</h2><p>若home.js和news.js有相同数据，则将数据封装到service</p>
<p>/service/news.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getNewsList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 注意获取新闻数据</span></span><br><span class="line">  <span class="keyword">const</span> list = [ <span class="string">&#x27;1111&#x27;</span>, <span class="string">&#x27;2222&#x27;</span>, <span class="string">&#x27;3333&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>home.js</code>和<code>news.js</code>使用该数据</p>
<p>调用<code>this.service.news.getNewsList();</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// const &#123; ctx &#125; = this;</span></span><br><span class="line">    <span class="comment">// ctx.body = &#x27;你好egg.js&#x27;;</span></span><br><span class="line">    <span class="comment">// 调用服务里面的方法 注意异步：await</span></span><br><span class="line">    <span class="keyword">const</span> list = <span class="keyword">await</span> <span class="built_in">this</span>.service.news.getNewsList();</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;home&#x27;</span>, &#123;</span><br><span class="line">      list,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p>控制器（api）的访问</p>
<p>在config.default.js中配置api</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.api = <span class="string">&#x27;http://www.itying.com/api&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>可以在service或控制器中直接使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取config的数据</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span>.config.api);</span><br></pre></td></tr></table></figure>

<p>服务继承Service为了方便egg在this上面绑定以下的方法</p>
<ul>
<li><code>this.ctx</code>: 当前请求的上下文 <a target="_blank" rel="noopener" href="https://eggjs.org/zh-cn/basics/extend.html#context">Context</a> 对象的实例，通过它我们可以拿到框架封装好的处理当前请求的各种便捷属性和方法。</li>
<li><code>this.app</code>: 当前应用 <a target="_blank" rel="noopener" href="https://eggjs.org/zh-cn/basics/extend.html#application">Application</a> 对象的实例，通过它我们可以拿到框架提供的全局对象和方法。</li>
<li><code>this.service</code>：应用定义的 <a target="_blank" rel="noopener" href="https://eggjs.org/zh-cn/basics/service.html">Service</a>，通过它我们可以访问到其他业务层，等价于 <code>this.ctx.service</code> 。</li>
<li><code>this.config</code>：应用运行时的<a target="_blank" rel="noopener" href="https://eggjs.org/zh-cn/basics/config.html">配置项</a>。</li>
<li><code>this.logger</code>：logger 对象，上面有四个方法（<code>debug</code>，<code>info</code>，<code>warn</code>，<code>error</code>），分别代表打印四个不同级别的日志，使用方法和效果与 <a target="_blank" rel="noopener" href="https://eggjs.org/zh-cn/core/logger.html#context-logger">context logger</a> 中介绍的一样，但是通过这个 logger 对象记录的日志，在日志前面会加上打印该日志的文件路径，以便快速定位日志打印位置。</li>
</ul>
<h2 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h2><p>创建user服务返回一个对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Service = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).Service;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">getUserInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = UserService;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可在控制器被调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> <span class="built_in">this</span>.service.user.getUserInfo();</span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;news&#x27;</span>, &#123;</span><br><span class="line">  user,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>也可在另一个服务被调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用user服务的数据</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> <span class="built_in">this</span>.service.user.getUserInfo();</span><br><span class="line"><span class="built_in">console</span>.log(user);</span><br></pre></td></tr></table></figure>

<p>在HTML渲染</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>姓名：&lt;%=user.name%&gt; 年龄：&lt;%=user.age%&gt;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结</p>
<ul>
<li>控制器可以调用服务，一个服务可被多个控制器调用，一个控制器可以调用不同的服务</li>
<li>服务之间可相互调用</li>
<li>注意：服务不能调用控制器，控制器也不能相互调用</li>
</ul>
<p>//服务的命名规则<br>Service文件必须放在app/service 目录，可以支持多级目录， 访问的时侯可以通过目录名级联访问。<br><code>app/service/biz/user.js =&gt; ctx. service .biz .user</code><br><code>app/ service/sync_ user.js =&gt; ctx. service . syncUser</code><br><code>app/ service/HackerNews.js =&gt; ctx . service . hackerNews</code></p>
<h2 id="爬取api接口数据"><a href="#爬取api接口数据" class="headerlink" title="爬取api接口数据"></a>爬取api接口数据</h2><ul>
<li>控制器访问服务</li>
<li>在服务中通过抓取接口返回数据</li>
<li>使用render将获取的数据显示到界面</li>
</ul>
<p>配置路由router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Egg.Application&#125;</span> <span class="variable">app</span></span> - egg application</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; router, controller &#125; = app;</span><br><span class="line">  router.get(<span class="string">&#x27;/&#x27;</span>, controller.home.index);</span><br><span class="line">  router.get(<span class="string">&#x27;/news&#x27;</span>, controller.news.index);</span><br><span class="line">  router.get(<span class="string">&#x27;/newscontent&#x27;</span>, controller.news.content);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>控制器news.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).Controller;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewsController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取数据显示到新闻界面</span></span><br><span class="line">    <span class="keyword">const</span> list = <span class="keyword">await</span> <span class="built_in">this</span>.service.news.getNewsList();</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;news&#x27;</span>,&#123;</span><br><span class="line">        list,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">content</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">//获取get传值</span></span><br><span class="line">      <span class="keyword">const</span> aid = <span class="built_in">this</span>.ctx.query.aid;</span><br><span class="line">      <span class="built_in">console</span>.log(aid);</span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">await</span> <span class="built_in">this</span>.service.news.getNewsContent(aid);</span><br><span class="line">      <span class="built_in">console</span>.log(list);</span><br><span class="line">      <span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;newscontent&#x27;</span>,&#123;</span><br><span class="line">        <span class="attr">list</span>:list[<span class="number">0</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = NewsController;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>服务news.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Service = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).Service;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewsService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取新闻列表</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">getNewsList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1、通过抓取接口返回数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、curl的方法可以获取远程的数据</span></span><br><span class="line">    <span class="keyword">const</span> api = <span class="built_in">this</span>.config.api+<span class="string">&#x27;appapi.php?a=getPortalList&amp;catid=20&amp;page=1&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.curl(api);</span><br><span class="line">    <span class="comment">// console.log(response.data); //返回的是Buffer类型的数据</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">JSON</span>.parse(response.data);<span class="comment">//把Buffer转化为对象</span></span><br><span class="line">    <span class="comment">// console.log(data);</span></span><br><span class="line">    <span class="keyword">return</span> data.result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取新闻详情</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">getNewsContent</span>(<span class="params">aid</span>)</span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">const</span> api = <span class="built_in">this</span>.config.api+<span class="string">&#x27;appapi.php?a=getPortalArticle&amp;aid=&#x27;</span>+aid;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="built_in">this</span>.ctx.curl(api);</span><br><span class="line">    <span class="comment">// console.log(response.data); //返回的是Buffer类型的数据</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">JSON</span>.parse(response.data);<span class="comment">//把Buffer转化为对象</span></span><br><span class="line">    <span class="comment">// console.log(data);</span></span><br><span class="line">    <span class="keyword">return</span> data.result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = NewsService;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>news.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>新闻列表数据<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &lt;%for(var i=0;i&lt;list.length;i++)&#123;%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/newscontent?aid=&lt;%=list[i].aid%&gt;&quot;</span>&gt;</span>&lt;%=list[i].title%&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>---&lt;%=list[i].dateline%&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &lt;%&#125;%&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>newscontent.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/css/basic.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&lt;%=list.title%&gt;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &lt;%-list.content%&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="extend"><a href="#extend" class="headerlink" title="extend"></a>extend</h2><ul>
<li>Application</li>
<li>Context</li>
<li>Request</li>
<li>Response</li>
<li>Helper</li>
</ul>
<p>新建extend/helper.js</p>
<p>扩展里面引入第三方模块</p>
<p>1、安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i silly-datetime --save</span><br></pre></td></tr></table></figure>

<p>2、使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//扩展里面引入第三方模块</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * https://www.npmjs.com/package/silly-datetime</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sd = <span class="built_in">require</span>(<span class="string">&#x27;silly-datetime&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="function"><span class="title">formatTime</span>(<span class="params">param</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// this 是 helper 对象，在其中可以调用其他 helper 方法</span></span><br><span class="line">      <span class="comment">// this.ctx =&gt; context 对象</span></span><br><span class="line">      <span class="comment">// this.app =&gt; application 对象</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// console.log(param);</span></span><br><span class="line">      <span class="comment">// console.log(new Date(param));</span></span><br><span class="line">      <span class="comment">//格式化日期 param（时间戳）</span></span><br><span class="line">    <span class="keyword">return</span> sd.format(<span class="keyword">new</span> <span class="built_in">Date</span>(param*<span class="number">1000</span>), <span class="string">&#x27;YYYY-MM-DD HH:mm&#x27;</span>);  </span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>在news.html中调用helper.formatTime()</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>新闻列表数据<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &lt;%for(var i=0;i&lt;list.length;i++)&#123;%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/newscontent?aid=&lt;%=list[i].aid%&gt;&quot;</span>&gt;</span>&lt;%=list[i].title%&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>---&lt;%=helper.formatTime(list[i].dateline)%&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &lt;%&#125;%&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：10位的时间戳在JavaScript中被认为是无效的时间戳 ，解决方法将param*1000</p>
<p>调用extend里面扩展的helper方法：</p>
<p>1、在extend/helper.js中增加getHelperData方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//扩展里面引入第三方模块</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * https://www.npmjs.com/package/silly-datetime</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sd = <span class="built_in">require</span>(<span class="string">&#x27;silly-datetime&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="function"><span class="title">formatTime</span>(<span class="params">param</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// this 是 helper 对象，在其中可以调用其他 helper 方法</span></span><br><span class="line">      <span class="comment">// this.ctx =&gt; context 对象</span></span><br><span class="line">      <span class="comment">// this.app =&gt; application 对象</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// console.log(param);</span></span><br><span class="line">      <span class="comment">// console.log(new Date(param));</span></span><br><span class="line">      <span class="comment">//格式化日期 param（时间戳）</span></span><br><span class="line">    <span class="keyword">return</span> sd.format(<span class="keyword">new</span> <span class="built_in">Date</span>(param*<span class="number">1000</span>), <span class="string">&#x27;YYYY-MM-DD HH:mm&#x27;</span>);  </span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">getHelperData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;我是helper里面的数据&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>在app/controller/home.js中调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).Controller;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//调用extend里面扩展的application</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.app.foo());</span><br><span class="line">    <span class="comment">//调用extend里面扩展的ctx</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.ctx.getHost());</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//调用extend里面扩展的helper方法</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.ctx.helper.getHelperData());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = HomeController;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p>中间件：匹配路由前、匹配路由完成做的一系列操作。</p>
<p>1、新建middleware/printdate.js中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment">options:中间件的配置项，框架会将app . config[ $&#123; middlewareName&#125;]传递进来。</span></span><br><span class="line"><span class="comment">app:当前应用Application 的实例。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">options,app</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//返回一个异步的方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">printDate</span>(<span class="params">ctx,next</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在config.default.js中配置中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add your middleware config here</span></span><br><span class="line">config.middleware = [<span class="string">&#x27;printdate&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>3、给printdate中间件传入的参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config.printdate = &#123;</span><br><span class="line">  <span class="attr">aaa</span>:<span class="string">&#x27;aaaaaaaa&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、打印options</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment">options:中间件的配置项，框架会将app . config[ $&#123; middlewareName&#125;]传递进来。</span></span><br><span class="line"><span class="comment">app:当前应用Application 的实例。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">options,app</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(options);</span><br><span class="line">    <span class="comment">//返回一个异步的方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">printDate</span>(<span class="params">ctx,next</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>利用中间件屏蔽id：</p>
<p>要屏蔽的id：1、从数据库获取</p>
<p>新建middleware/forbidip.js中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">options,app</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//返回一个异步的方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">forbidIp</span>(<span class="params">ctx,next</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//要屏蔽的id：1、从数据库获取 2、从参数传入</span></span><br><span class="line">        <span class="keyword">var</span> forbidip = <span class="string">&#x27;127.0.0.1&#x27;</span>;<span class="comment">//要屏蔽的IP</span></span><br><span class="line">        <span class="comment">//获取客户端的IP</span></span><br><span class="line">        <span class="comment">// console.log(ctx.request.ip);</span></span><br><span class="line">        <span class="keyword">if</span>(ctx.request.ip == forbidip)&#123;</span><br><span class="line">            ctx.status = <span class="number">403</span>;</span><br><span class="line">            ctx.body = <span class="string">&#x27;您的IP已经被屏蔽&#x27;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">await</span> next();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增加配置中间件</span></span><br><span class="line">config.middleware = [<span class="string">&#x27;printdate&#x27;</span>,<span class="string">&#x27;forbidip&#x27;</span>];</span><br></pre></td></tr></table></figure>



<p>2、从参数传入</p>
<p>在config.default.js中配置要屏蔽的id</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config.forbidip = &#123;</span><br><span class="line">  <span class="attr">forbidips</span>:[</span><br><span class="line">    <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;192.168.56.1&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>middleware/forbidip.js中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">options,app</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//返回一个异步的方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">forbidIp</span>(<span class="params">ctx,next</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//要屏蔽的id：2、从参数传入</span></span><br><span class="line">        <span class="keyword">var</span> forbidips = options.forbidips;<span class="comment">//要屏蔽的IP</span></span><br><span class="line">        <span class="comment">// console.log(forbidip);</span></span><br><span class="line">        <span class="comment">//获取客户端的IP</span></span><br><span class="line">        <span class="keyword">var</span> clientIp = ctx.request.ip;</span><br><span class="line">        <span class="comment">//some和forEach相似</span></span><br><span class="line">        <span class="keyword">var</span> hasIp = forbidips.some(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// console.log(val);</span></span><br><span class="line">            <span class="keyword">if</span>(val == clientIp)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span>(hasIp)&#123;</span><br><span class="line">            <span class="comment">//屏蔽</span></span><br><span class="line">            ctx.status = <span class="number">403</span>;</span><br><span class="line">            ctx.body = <span class="string">&#x27;您的IP已经被屏蔽&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">await</span> next();</span><br><span class="line">        &#125; </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="post提交数据"><a href="#post提交数据" class="headerlink" title="post提交数据"></a>post提交数据</h2><p>新建home.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/add&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>增加控制器 home.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Controller = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>).Controller;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">index</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// this.ctx.csrf 用户访问这个页面的时候生成一个密钥</span></span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接收post提交数据 this.ctx.request.body</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.ctx.request.body);</span><br><span class="line">    <span class="built_in">this</span>.ctx.body = <span class="built_in">this</span>.ctx.request.body;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = HomeController;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>增加路由 router.ja</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Egg.Application&#125;</span> <span class="variable">app</span></span> - egg application</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; router, controller &#125; = app;</span><br><span class="line">  router.get(<span class="string">&#x27;/&#x27;</span>, controller.home.index);</span><br><span class="line">  router.post(<span class="string">&#x27;/add&#x27;</span>, controller.home.add);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>●cookie 是存储于访问者的计算机中的变量。可以让我们用同一个浏览器访问同一一个域<br>名的时候共享数据。<br>心<br>●HTTP 是无状态协议。简单地说，当你浏览了一个页面，然后转到同一个网站的另-一个页<br>面，服务器无法认识到这是同一个浏览器在访问同一一个网站。每-一次的访问，都是没有任何<br>关系的。</p>
<p><code>cookie:  1.可以实现同一个浏览器访问同一个域的时候不同页面之间的数据共享 2、实现数据的持久化(关子浏览器重新打开以后数据还存在)</code></p>
<h3 id="需求：同一个浏览器访问同一个域，news页面能访问到主页面的值"><a href="#需求：同一个浏览器访问同一个域，news页面能访问到主页面的值" class="headerlink" title="需求：同一个浏览器访问同一个域，news页面能访问到主页面的值"></a>需求：同一个浏览器访问同一个域，news页面能访问到主页面的值</h3><p>1、在home.js下设置一个值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置一个值</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 第一个参数：cookies的名称</span></span><br><span class="line"><span class="comment"> * 第二个参数：cookies的值</span></span><br><span class="line"><span class="comment"> * 第二个参数：配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">this</span>.ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>2、在news.js获取到这个值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> username = <span class="built_in">this</span>.ctx.cookies.get(<span class="string">&#x27;username&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>3、再将这个值渲染到页面上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;news&#x27;</span>, &#123;</span><br><span class="line">      username,</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>4、在news.html页面中打印这个值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>我是一个新闻页面-----&#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="需求-实现数据的持久化"><a href="#需求-实现数据的持久化" class="headerlink" title="需求:实现数据的持久化"></a>需求:实现数据的持久化</h3><p>默认情况:cookies当浏览器关闭以后就销毁了</p>
<p>注意:默认情况下面egg.js里面的cookie没法设置中文</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span>,&#123;</span><br><span class="line">     <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">3600</span> * <span class="number">24</span>, <span class="comment">// cookie存储一天</span></span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>



<h3 id="其他参数："><a href="#其他参数：" class="headerlink" title="其他参数："></a>其他参数：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.ctx.cookies.set(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">3600</span> * <span class="number">24</span>, <span class="comment">// cookie存储一天</span></span><br><span class="line">  <span class="attr">httpOnly</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">signed</span>: <span class="literal">true</span>, <span class="comment">// 对cookie进行签名防止 用户修改cookie</span></span><br><span class="line">  <span class="attr">encrypt</span>: <span class="literal">true</span>, <span class="comment">// 是否对cookie进行加密 如果coolie加密那么获取的时候要对cookie进行解密</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>获取时解密</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取cookie</span></span><br><span class="line"><span class="comment">// const username = this.ctx.cookies.get(&#x27;username&#x27;);</span></span><br><span class="line"><span class="comment">// 获取加密的cookie</span></span><br><span class="line"><span class="keyword">const</span> username = <span class="built_in">this</span>.ctx.cookies.get(<span class="string">&#x27;username&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">encrypt</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="设置中文cookie-encrypt-true"><a href="#设置中文cookie-encrypt-true" class="headerlink" title="设置中文cookie (encrypt :true)"></a>设置中文cookie (encrypt :true)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果cookie加密以后就可以设置中文cookie (encrypt :true)</span></span><br><span class="line"><span class="built_in">this</span>.ctx.cookies.set(<span class="string">&#x27;userinfo&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">3600</span> * <span class="number">24</span>, <span class="comment">// cookie存储一天</span></span><br><span class="line">  <span class="attr">httpOnly</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">signed</span>: <span class="literal">true</span>, <span class="comment">// 对cookie进行签名防止 用户修改cookie</span></span><br><span class="line">  <span class="attr">encrypt</span>: <span class="literal">true</span>, <span class="comment">// 是否对cookie进行加密 如果coolie加密那么获取的时候要对cookie进行解密</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="清除cookie"><a href="#清除cookie" class="headerlink" title="清除cookie"></a>清除cookie</h3><p>方法1：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">loginOut</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 清除cookies</span></span><br><span class="line">  <span class="built_in">this</span>.ctx.cookies.set(<span class="string">&#x27;userinfo&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// 路由跳转</span></span><br><span class="line">  <span class="built_in">this</span>.ctx.redirect(<span class="string">&#x27;/news&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法2：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.ctx.cookies.set(<span class="string">&#x27;userinfo&#x27;</span>, <span class="literal">null</span>,&#123;</span><br><span class="line">  <span class="attr">maxAge</span>: <span class="number">0</span>,<span class="comment">// cookie存储0</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="session基于Cookie"><a href="#session基于Cookie" class="headerlink" title="session基于Cookie"></a>session基于Cookie</h2><ul>
<li><p>session是另一种记录客户状态的机制，不同的是Cookie保存在客户端浏览器中，而<br>session保存在服务器上。</p>
</li>
<li><p>当浏览器访问服务器并发送第一次请求时 ,服务器端会创建一个session对象,生成一<br>个类似于key,value的键值对，然后将key(cookie)返回到浏览器(客户)端,浏览器下次再<br>访问时,携带key(cookie) ,找到对应的session(value)。</p>
</li>
</ul>
<p>1、设置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置session</span></span><br><span class="line"><span class="built_in">this</span>.ctx.session.username = <span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>.ctx.session.userinfo = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>2、获取</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userName = <span class="built_in">this</span>.ctx.session.username;</span><br><span class="line"><span class="keyword">const</span> userinfo = <span class="built_in">this</span>.ctx.session.userinfo;</span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.ctx.render(<span class="string">&#x27;news&#x27;</span>, &#123;</span><br><span class="line">      userName,</span><br><span class="line">      userinfo,</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>



<p>设置session的过期时间5s 基于cookie  不建议使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置session的过期时间5s 基于cookie</span></span><br><span class="line"><span class="built_in">this</span>.ctx.session.maxAge = <span class="number">5000</span>;</span><br></pre></td></tr></table></figure>

<p>在<code>config.default.js</code>中的配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置session session的配置和cookie基本是一样的</span></span><br><span class="line">config.session = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;EGG_SESS&#x27;</span>, <span class="comment">// 设置session cookie里面的key</span></span><br><span class="line">  <span class="attr">maxAge</span>: <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>, <span class="comment">// 过期时间 1 天</span></span><br><span class="line">  <span class="attr">httpOnly</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">encrypt</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">renew</span>: <span class="literal">true</span>, <span class="comment">// renew等于true 那么每次刷新页面的时候session都会 被延期</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p>1、get请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let query = this.ctx.query;</span><br><span class="line">let name = query.name;</span><br><span class="line">let id = query.id;</span><br></pre></td></tr></table></figure>

<p>2、post请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let query = this.ctx.request.body;</span><br><span class="line">let name = query.name;</span><br><span class="line">let id = query.id;</span><br></pre></td></tr></table></figure>

<p>3、接口返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">this.ctx.body = &#123;</span><br><span class="line">    code: 0,</span><br><span class="line">    data: &#x27;返回的数据&#x27;,</span><br><span class="line">    msg: &#x27;错误数据&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5>本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "http://example.com/2021/09/20/egg.js/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "http://example.com/2021/09/20/egg.js/";
            const title         = "「egg」";
            const excerpt       = `egg.js参考教程视频 https://b23.tv/wu9Dc9
egg.js 的特性:1、提供基于 Egg 定制上层框架的能力2、高度可扩展的插件机制3、内置多进程管理
4、基于 Koa 开发，性能优异5、框架稳定，测试覆盖率高...`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    <a class="tag-none-link" href="/tags/egg/" rel="tag">egg</a>
                </div>
                <div class="pull-date">
                <span>最后编辑：2021-09-21</span>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" flex弹性布局" href="/2021/09/20/flex弹性布局/">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" 浏览器的工作原理" href="/2021/10/18/浏览器的工作原理：新式网络浏览器幕后揭秘/">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
</article>

        

            </section>

        

                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/avatar.webp" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix">
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar"></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#egg-js"><span class="toc-text">egg.js</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#egg-js-%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-text">egg.js 的特性:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAegg%E7%9A%84%E7%8E%AF%E5%A2%83"><span class="toc-text">创建egg的环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-text">路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96get%E4%BC%A0%E5%80%BC"><span class="toc-text">获取get传值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-text">动态路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E-%E8%A7%86%E5%9B%BE%EF%BC%88view%EF%BC%89egg-view-ejs"><span class="toc-text">加载模板引擎  视图（view）egg-view-ejs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%95%B0%E6%8D%AE%E5%86%97%E4%BD%99"><span class="toc-text">解决数据冗余</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1"><span class="toc-text">服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%AC%E5%8F%96api%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE"><span class="toc-text">爬取api接口数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extend"><span class="toc-text">extend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#post%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE"><span class="toc-text">post提交数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie"><span class="toc-text">Cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E5%90%8C%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E5%90%8C%E4%B8%80%E4%B8%AA%E5%9F%9F%EF%BC%8Cnews%E9%A1%B5%E9%9D%A2%E8%83%BD%E8%AE%BF%E9%97%AE%E5%88%B0%E4%B8%BB%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%80%BC"><span class="toc-text">需求：同一个浏览器访问同一个域，news页面能访问到主页面的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82-%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">需求:实现数据的持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-text">其他参数：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%96%87cookie-encrypt-true"><span class="toc-text">设置中文cookie (encrypt :true)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4cookie"><span class="toc-text">清除cookie</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session%E5%9F%BA%E4%BA%8ECookie"><span class="toc-text">session基于Cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82"><span class="toc-text">请求</span></a></li></ol></li></ol>
    </div>
</aside>
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AD%A3%E5%88%99/">正则</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9B%B6%E6%95%A3%E7%9F%A5%E8%AF%86/">零散知识</a><span class="category-list-count">1</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/HTTP/" style="font-size: 0.6em;">HTTP</a> <a href="/tags/Vue/" style="font-size: 0.73em;">Vue</a> <a href="/tags/css/" style="font-size: 0.6em;">css</a> <a href="/tags/egg/" style="font-size: 0.6em;">egg</a> <a href="/tags/flex%E5%BC%B9%E6%80%A7%E5%B8%83%E5%B1%80/" style="font-size: 0.6em;">flex弹性布局</a> <a href="/tags/hexo/" style="font-size: 0.6em;">hexo</a> <a href="/tags/koa/" style="font-size: 0.6em;">koa</a> <a href="/tags/node/" style="font-size: 0.6em;">node</a> <a href="/tags/npm/" style="font-size: 0.6em;">npm</a> <a href="/tags/react/" style="font-size: 0.6em;">react</a> <a href="/tags/vue/" style="font-size: 0.8em;">vue</a> <a href="/tags/wamp/" style="font-size: 0.6em;">wamp</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 0.67em;">前端</a> <a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 0.6em;">微信小程序</a> <a href="/tags/%E6%AD%A3%E5%88%99%E6%A0%A1%E9%AA%8C/" style="font-size: 0.67em;">正则校验</a> <a href="/tags/%E9%9B%B6%E9%9B%B6%E6%95%A3%E6%95%A3/" style="font-size: 0.6em;">零零散散</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2022/07/18/vue%E8%A1%A5%E5%85%85/"><i class="fa  fa-book"></i> vue补充</a>
            
          
        
          
          
            <a class="list-group-item" href="/2022/07/18/vue/"><i class="fa  fa-book"></i> vue</a>
            
          
        
          
          
            <a class="list-group-item" href="/2022/07/14/VUE3/"><i class="fa  fa-book"></i> vue3</a>
            
          
        
          
          
            <a class="list-group-item" href="/2022/03/19/%E5%B0%9A%E7%A1%85%E8%B0%B7react%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/"><i class="fa  fa-book"></i> 尚硅谷react课程笔记</a>
            
          
        
          
          
            <a class="list-group-item" href="/2021/11/01/%E9%9A%8F%E6%89%8B%E8%AE%B0/"><i class="fa  fa-book"></i> 随手记</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  class="ap-lrc"  >
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        
                        
                        <li><a target="_blank" rel="nofollow" href="https://t.me/CandyUnion"><i class="fa fa-telegram"></i></a></li>
                        
                        
                        
                        <li><a target="_blank" rel="me" href="https://nya.one/@Candinya"><i class="fa fa fa-share-alt-square"></i></a></li>
                        <li><a target="_blank" rel="nofollow" href="https://github.com/Candinya"><i class="fa fa-github"></i></a></li>
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2022 琼喵酱·部落 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by zengqm.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>
<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>


    <script async src="/js/candy.min.js"></script>



    <script defer src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    <meting-js
        server="netease"
        type="playlist"
        id="3204190542"
        order="random"
        fixed="true"
    >
    </meting-js>



    <script defer src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>


    <script defer src="/js/kr-dark.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>
</html>